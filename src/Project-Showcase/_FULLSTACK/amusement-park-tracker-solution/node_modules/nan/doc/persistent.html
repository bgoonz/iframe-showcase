<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>persistent</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h2 id="persistent-references">Persistent references</h2>
<p>An object reference that is independent of any <code>HandleScope</code> is a <em>persistent</em> reference. Where a <code>Local</code> handle only lives as long as the <code>HandleScope</code> in which it was allocated, a <code>Persistent</code> handle remains valid until it is explicitly disposed.</p>
<p>Due to the evolution of the V8 API, it is necessary for NAN to provide a wrapper implementation of the <code>Persistent</code> classes to supply compatibility across the V8 versions supported.</p>
<ul>
<li><a href="#api_nan_persistent_base"><b><code>Nan::PersistentBase &amp; v8::PersistentBase</code></b></a></li>
<li><a href="#api_nan_non_copyable_persistent_traits"><b><code>Nan::NonCopyablePersistentTraits &amp; v8::NonCopyablePersistentTraits</code></b></a></li>
<li><a href="#api_nan_copyable_persistent_traits"><b><code>Nan::CopyablePersistentTraits &amp; v8::CopyablePersistentTraits</code></b></a></li>
<li><a href="#api_nan_persistent"><b><code>Nan::Persistent</code></b></a></li>
<li><a href="#api_nan_global"><b><code>Nan::Global</code></b></a></li>
<li><a href="#api_nan_weak_callback_info"><b><code>Nan::WeakCallbackInfo</code></b></a></li>
<li><a href="#api_nan_weak_callback_type"><b><code>Nan::WeakCallbackType</code></b></a></li>
</ul>
<p>Also see the V8 Embedders Guide section on <a href="https://developers.google.com/v8/embed#handles">Handles and Garbage Collection</a>.</p>
<p><a name="api_nan_persistent_base"></a> ### Nan::PersistentBase &amp; v8::PersistentBase</p>
<p>A persistent handle contains a reference to a storage cell in V8 which holds an object value and which is updated by the garbage collector whenever the object is moved. A new storage cell can be created using the constructor or <code>Nan::PersistentBase::Reset()</code>. Existing handles can be disposed using an argument-less <code>Nan::PersistentBase::Reset()</code>.</p>
<p>Definition:</p>
<p><em>(note: this is implemented as <code>Nan::PersistentBase</code> for older versions of V8 and the native <code>v8::PersistentBase</code> is used for newer versions of V8)</em></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt; <span class="kw">class</span> PersistentBase {</a>
<a class="sourceLine" id="cb1-2" title="2"> <span class="kw">public</span>:</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">   * If non-empty, destroy the underlying storage cell</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">   */</span></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="dt">void</span> Reset();</a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">   * If non-empty, destroy the underlying storage cell and create a new one with</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">   * the contents of another if it is also non-empty</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">   */</span></a>
<a class="sourceLine" id="cb1-12" title="12">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S&gt; <span class="dt">void</span> Reset(<span class="at">const</span> v8::Local&lt;S&gt; &amp;other);</a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="co">   * If non-empty, destroy the underlying storage cell and create a new one with</span></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">   * the contents of another if it is also non-empty</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co">   */</span></a>
<a class="sourceLine" id="cb1-18" title="18">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S&gt; <span class="dt">void</span> Reset(<span class="at">const</span> PersistentBase&lt;S&gt; &amp;other);</a>
<a class="sourceLine" id="cb1-19" title="19"></a>
<a class="sourceLine" id="cb1-20" title="20">  <span class="co">/** Returns true if the handle is empty. */</span></a>
<a class="sourceLine" id="cb1-21" title="21">  <span class="dt">bool</span> IsEmpty() <span class="at">const</span>;</a>
<a class="sourceLine" id="cb1-22" title="22"></a>
<a class="sourceLine" id="cb1-23" title="23">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="co">   * If non-empty, destroy the underlying storage cell</span></a>
<a class="sourceLine" id="cb1-25" title="25"><span class="co">   * IsEmpty() will return true after this call.</span></a>
<a class="sourceLine" id="cb1-26" title="26"><span class="co">   */</span></a>
<a class="sourceLine" id="cb1-27" title="27">  <span class="dt">void</span> Empty();</a>
<a class="sourceLine" id="cb1-28" title="28"></a>
<a class="sourceLine" id="cb1-29" title="29">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S&gt; <span class="dt">bool</span> <span class="kw">operator</span>==(<span class="at">const</span> PersistentBase&lt;S&gt; &amp;that);</a>
<a class="sourceLine" id="cb1-30" title="30"></a>
<a class="sourceLine" id="cb1-31" title="31">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S&gt; <span class="dt">bool</span> <span class="kw">operator</span>==(<span class="at">const</span> v8::Local&lt;S&gt; &amp;that);</a>
<a class="sourceLine" id="cb1-32" title="32"></a>
<a class="sourceLine" id="cb1-33" title="33">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S&gt; <span class="dt">bool</span> <span class="kw">operator</span>!=(<span class="at">const</span> PersistentBase&lt;S&gt; &amp;that);</a>
<a class="sourceLine" id="cb1-34" title="34"></a>
<a class="sourceLine" id="cb1-35" title="35">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S&gt; <span class="dt">bool</span> <span class="kw">operator</span>!=(<span class="at">const</span> v8::Local&lt;S&gt; &amp;that);</a>
<a class="sourceLine" id="cb1-36" title="36"></a>
<a class="sourceLine" id="cb1-37" title="37">   <span class="co">/**</span></a>
<a class="sourceLine" id="cb1-38" title="38"><span class="co">   *  Install a finalization callback on this object.</span></a>
<a class="sourceLine" id="cb1-39" title="39"><span class="co">   *  </span><span class="al">NOTE</span><span class="co">: There is no guarantee as to *when* or even *if* the callback is</span></a>
<a class="sourceLine" id="cb1-40" title="40"><span class="co">   *  invoked. The invocation is performed solely on a best effort basis.</span></a>
<a class="sourceLine" id="cb1-41" title="41"><span class="co">   *  As always, GC-based finalization should *not* be relied upon for any</span></a>
<a class="sourceLine" id="cb1-42" title="42"><span class="co">   *  critical form of resource management! At the moment you can either</span></a>
<a class="sourceLine" id="cb1-43" title="43"><span class="co">   *  specify a parameter for the callback or the location of two internal</span></a>
<a class="sourceLine" id="cb1-44" title="44"><span class="co">   *  fields in the dying object.</span></a>
<a class="sourceLine" id="cb1-45" title="45"><span class="co">   */</span></a>
<a class="sourceLine" id="cb1-46" title="46">  <span class="kw">template</span>&lt;<span class="kw">typename</span> P&gt;</a>
<a class="sourceLine" id="cb1-47" title="47">  <span class="dt">void</span> SetWeak(P *parameter,</a>
<a class="sourceLine" id="cb1-48" title="48">               <span class="kw">typename</span> WeakCallbackInfo&lt;P&gt;::Callback callback,</a>
<a class="sourceLine" id="cb1-49" title="49">               WeakCallbackType type);</a>
<a class="sourceLine" id="cb1-50" title="50"></a>
<a class="sourceLine" id="cb1-51" title="51">  <span class="dt">void</span> ClearWeak();</a>
<a class="sourceLine" id="cb1-52" title="52"></a>
<a class="sourceLine" id="cb1-53" title="53">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb1-54" title="54"><span class="co">   * Marks the reference to this object independent. Garbage collector is free</span></a>
<a class="sourceLine" id="cb1-55" title="55"><span class="co">   * to ignore any object groups containing this object. Weak callback for an</span></a>
<a class="sourceLine" id="cb1-56" title="56"><span class="co">   * independent handle should not assume that it will be preceded by a global</span></a>
<a class="sourceLine" id="cb1-57" title="57"><span class="co">   * GC prologue callback or followed by a global GC epilogue callback.</span></a>
<a class="sourceLine" id="cb1-58" title="58"><span class="co">   */</span></a>
<a class="sourceLine" id="cb1-59" title="59">  <span class="dt">void</span> MarkIndependent() <span class="at">const</span>;</a>
<a class="sourceLine" id="cb1-60" title="60"></a>
<a class="sourceLine" id="cb1-61" title="61">  <span class="dt">bool</span> IsIndependent() <span class="at">const</span>;</a>
<a class="sourceLine" id="cb1-62" title="62"></a>
<a class="sourceLine" id="cb1-63" title="63">  <span class="co">/** Checks if the handle holds the only reference to an object. */</span></a>
<a class="sourceLine" id="cb1-64" title="64">  <span class="dt">bool</span> IsNearDeath() <span class="at">const</span>;</a>
<a class="sourceLine" id="cb1-65" title="65"></a>
<a class="sourceLine" id="cb1-66" title="66">  <span class="co">/** Returns true if the handle&#39;s reference is weak.  */</span></a>
<a class="sourceLine" id="cb1-67" title="67">  <span class="dt">bool</span> IsWeak() <span class="at">const</span></a>
<a class="sourceLine" id="cb1-68" title="68">};</a></code></pre></div>
<p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.11/d4/dca/classv8_1_1_persistent_base.html"><code>PersistentBase</code></a> for further information.</p>
<p><strong>Tip:</strong> To get a <code>v8::Local</code> reference to the original object back from a <code>PersistentBase</code> or <code>Persistent</code> object:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1">v8::Local&lt;v8::Object&gt; object = Nan::New(persistent);</a></code></pre></div>
<p><a name="api_nan_non_copyable_persistent_traits"></a> ### Nan::NonCopyablePersistentTraits &amp; v8::NonCopyablePersistentTraits</p>
<p>Default traits for <code>Nan::Persistent</code>. This class does not allow use of the a copy constructor or assignment operator. At present <code>kResetInDestructor</code> is not set, but that will change in a future version.</p>
<p>Definition:</p>
<p><em>(note: this is implemented as <code>Nan::NonCopyablePersistentTraits</code> for older versions of V8 and the native <code>v8::NonCopyablePersistentTraits</code> is used for newer versions of V8)</em></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt; <span class="kw">class</span> NonCopyablePersistentTraits {</a>
<a class="sourceLine" id="cb3-2" title="2"> <span class="kw">public</span>:</a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="kw">typedef</span> Persistent&lt;T, NonCopyablePersistentTraits&lt;T&gt; &gt; NonCopyablePersistent;</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="at">static</span> <span class="at">const</span> <span class="dt">bool</span> kResetInDestructor = <span class="kw">false</span>;</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S, <span class="kw">typename</span> M&gt;</a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="at">static</span> <span class="dt">void</span> Copy(<span class="at">const</span> Persistent&lt;S, M&gt; &amp;source,</a>
<a class="sourceLine" id="cb3-9" title="9">                   NonCopyablePersistent *dest);</a>
<a class="sourceLine" id="cb3-10" title="10"></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="kw">template</span>&lt;<span class="kw">typename</span> O&gt; <span class="at">static</span> <span class="dt">void</span> Uncompilable();</a>
<a class="sourceLine" id="cb3-12" title="12">};</a></code></pre></div>
<p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.11/de/d73/classv8_1_1_non_copyable_persistent_traits.html"><code>NonCopyablePersistentTraits</code></a> for further information.</p>
<p><a name="api_nan_copyable_persistent_traits"></a> ### Nan::CopyablePersistentTraits &amp; v8::CopyablePersistentTraits</p>
<p>A helper class of traits to allow copying and assignment of <code>Persistent</code>. This will clone the contents of storage cell, but not any of the flags, etc..</p>
<p>Definition:</p>
<p><em>(note: this is implemented as <code>Nan::CopyablePersistentTraits</code> for older versions of V8 and the native <code>v8::NonCopyablePersistentTraits</code> is used for newer versions of V8)</em></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt;</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">class</span> CopyablePersistentTraits {</a>
<a class="sourceLine" id="cb4-3" title="3"> <span class="kw">public</span>:</a>
<a class="sourceLine" id="cb4-4" title="4">  <span class="kw">typedef</span> Persistent&lt;T, CopyablePersistentTraits&lt;T&gt; &gt; CopyablePersistent;</a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="at">static</span> <span class="at">const</span> <span class="dt">bool</span> kResetInDestructor = <span class="kw">true</span>;</a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S, <span class="kw">typename</span> M&gt;</a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="at">static</span> <span class="dt">void</span> Copy(<span class="at">const</span> Persistent&lt;S, M&gt; &amp;source,</a>
<a class="sourceLine" id="cb4-10" title="10">                   CopyablePersistent *dest);</a>
<a class="sourceLine" id="cb4-11" title="11">};</a></code></pre></div>
<p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.11/da/d5c/structv8_1_1_copyable_persistent_traits.html"><code>CopyablePersistentTraits</code></a> for further information.</p>
<p><a name="api_nan_persistent"></a> ### Nan::Persistent</p>
<p>A type of <code>PersistentBase</code> which allows copy and assignment. Copy, assignment and destructor behavior is controlled by the traits class <code>M</code>.</p>
<p>Definition:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">template</span>&lt;<span class="kw">typename</span> T, <span class="kw">typename</span> M = NonCopyablePersistentTraits&lt;T&gt; &gt;</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">class</span> Persistent;</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">template</span>&lt;<span class="kw">typename</span> T, <span class="kw">typename</span> M&gt; <span class="kw">class</span> Persistent : <span class="kw">public</span> PersistentBase&lt;T&gt; {</a>
<a class="sourceLine" id="cb5-5" title="5"> <span class="kw">public</span>:</a>
<a class="sourceLine" id="cb5-6" title="6"> <span class="co">/**</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">  * A Persistent with no storage cell.</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">  */</span></a>
<a class="sourceLine" id="cb5-9" title="9">  Persistent();</a>
<a class="sourceLine" id="cb5-10" title="10"></a>
<a class="sourceLine" id="cb5-11" title="11">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">   * Construct a Persistent from a v8::Local. When the v8::Local is non-empty, a</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">   * new storage cell is created pointing to the same object, and no flags are</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">   * set.</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">   */</span></a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S&gt; Persistent(v8::Local&lt;S&gt; that);</a>
<a class="sourceLine" id="cb5-17" title="17"></a>
<a class="sourceLine" id="cb5-18" title="18">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="co">   * Construct a Persistent from a Persistent. When the Persistent is non-empty,</span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="co">   * a new storage cell is created pointing to the same object, and no flags are</span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="co">   * set.</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="co">   */</span></a>
<a class="sourceLine" id="cb5-23" title="23">  Persistent(<span class="at">const</span> Persistent &amp;that);</a>
<a class="sourceLine" id="cb5-24" title="24"></a>
<a class="sourceLine" id="cb5-25" title="25">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="co">   * The copy constructors and assignment operator create a Persistent exactly</span></a>
<a class="sourceLine" id="cb5-27" title="27"><span class="co">   * as the Persistent constructor, but the Copy function from the traits class</span></a>
<a class="sourceLine" id="cb5-28" title="28"><span class="co">   * is called, allowing the setting of flags based on the copied Persistent.</span></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="co">   */</span></a>
<a class="sourceLine" id="cb5-30" title="30">  Persistent &amp;<span class="kw">operator</span>=(<span class="at">const</span> Persistent &amp;that);</a>
<a class="sourceLine" id="cb5-31" title="31"></a>
<a class="sourceLine" id="cb5-32" title="32">  <span class="kw">template</span> &lt;<span class="kw">typename</span> S, <span class="kw">typename</span> M2&gt;</a>
<a class="sourceLine" id="cb5-33" title="33">  Persistent &amp;<span class="kw">operator</span>=(<span class="at">const</span> Persistent&lt;S, M2&gt; &amp;that);</a>
<a class="sourceLine" id="cb5-34" title="34"></a>
<a class="sourceLine" id="cb5-35" title="35">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb5-36" title="36"><span class="co">   * The destructor will dispose the Persistent based on the kResetInDestructor</span></a>
<a class="sourceLine" id="cb5-37" title="37"><span class="co">   * flags in the traits class.  Since not calling dispose can result in a</span></a>
<a class="sourceLine" id="cb5-38" title="38"><span class="co">   * memory leak, it is recommended to always set this flag.</span></a>
<a class="sourceLine" id="cb5-39" title="39"><span class="co">   */</span></a>
<a class="sourceLine" id="cb5-40" title="40">  ~Persistent();</a>
<a class="sourceLine" id="cb5-41" title="41">};</a></code></pre></div>
<p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.11/d2/d78/classv8_1_1_persistent.html"><code>Persistent</code></a> for further information.</p>
<p><a name="api_nan_global"></a> ### Nan::Global</p>
<p>A type of <code>PersistentBase</code> which has move semantics.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt; <span class="kw">class</span> Global : <span class="kw">public</span> PersistentBase&lt;T&gt; {</a>
<a class="sourceLine" id="cb6-2" title="2"> <span class="kw">public</span>:</a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="co">   * A Global with no storage cell.</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">   */</span></a>
<a class="sourceLine" id="cb6-6" title="6">  Global();</a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">   * Construct a Global from a v8::Local. When the v8::Local is non-empty, a new</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">   * storage cell is created pointing to the same object, and no flags are set.</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">   */</span></a>
<a class="sourceLine" id="cb6-12" title="12">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S&gt; Global(v8::Local&lt;S&gt; that);</a>
<a class="sourceLine" id="cb6-13" title="13">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">   * Construct a Global from a PersistentBase. When the Persistent is non-empty,</span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">   * a new storage cell is created pointing to the same object, and no flags are</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">   * set.</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">   */</span></a>
<a class="sourceLine" id="cb6-18" title="18">  <span class="kw">template</span>&lt;<span class="kw">typename</span> S&gt; Global(<span class="at">const</span> PersistentBase&lt;S&gt; &amp;that);</a>
<a class="sourceLine" id="cb6-19" title="19"></a>
<a class="sourceLine" id="cb6-20" title="20">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="co">   * Pass allows returning globals from functions, etc.</span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="co">   */</span></a>
<a class="sourceLine" id="cb6-23" title="23">  Global Pass();</a>
<a class="sourceLine" id="cb6-24" title="24">};</a></code></pre></div>
<p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.11/d5/d40/classv8_1_1_global.html"><code>Global</code></a> for further information.</p>
<p><a name="api_nan_weak_callback_info"></a> ### Nan::WeakCallbackInfo</p>
<p><code>Nan::WeakCallbackInfo</code> is used as an argument when setting a persistent reference as weak. You may need to free any external resources attached to the object. It is a mirror of <code>v8:WeakCallbackInfo</code> as found in newer versions of V8.</p>
<p>Definition:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">template</span>&lt;<span class="kw">typename</span> T&gt; <span class="kw">class</span> WeakCallbackInfo {</a>
<a class="sourceLine" id="cb7-2" title="2"> <span class="kw">public</span>:</a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="kw">typedef</span> <span class="dt">void</span> (*Callback)(<span class="at">const</span> WeakCallbackInfo&lt;T&gt;&amp; data);</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5">  v8::Isolate *GetIsolate() <span class="at">const</span>;</a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">   * Get the parameter that was associated with the weak handle.</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">   */</span></a>
<a class="sourceLine" id="cb7-10" title="10">  T *GetParameter() <span class="at">const</span>;</a>
<a class="sourceLine" id="cb7-11" title="11"></a>
<a class="sourceLine" id="cb7-12" title="12">  <span class="co">/**</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">   * Get pointer from internal field, index can be 0 or 1.</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">   */</span></a>
<a class="sourceLine" id="cb7-15" title="15">  <span class="dt">void</span> *GetInternalField(<span class="dt">int</span> index) <span class="at">const</span>;</a>
<a class="sourceLine" id="cb7-16" title="16">};</a></code></pre></div>
<p>Example usage:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb8-1" title="1"><span class="dt">void</span> weakCallback(<span class="at">const</span> WeakCallbackInfo&lt;<span class="dt">int</span>&gt; &amp;data) {</a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="dt">int</span> *parameter = data.GetParameter();</a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="kw">delete</span> parameter;</a>
<a class="sourceLine" id="cb8-4" title="4">}</a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6">Persistent&lt;v8::Object&gt; obj;</a>
<a class="sourceLine" id="cb8-7" title="7"><span class="dt">int</span> *data = <span class="kw">new</span> <span class="dt">int</span>(<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb8-8" title="8">obj.SetWeak(data, callback, WeakCallbackType::kParameter);</a></code></pre></div>
<p>See the V8 documentation for <a href="https://v8docs.nodesource.com/node-8.11/d8/d06/classv8_1_1_weak_callback_info.html"><code>WeakCallbackInfo</code></a> for further information.</p>
<p><a name="api_nan_weak_callback_type"></a> ### Nan::WeakCallbackType</p>
<p>Represents the type of a weak callback. A weak callback of type <code>kParameter</code> makes the supplied parameter to <code>Nan::PersistentBase::SetWeak</code> available through <code>WeakCallbackInfo::GetParameter</code>. A weak callback of type <code>kInternalFields</code> uses up to two internal fields at indices 0 and 1 on the <code>Nan::PersistentBase&lt;v8::Object&gt;</code> being made weak. Note that only <code>v8::Object</code>s and derivatives can have internal fields.</p>
<p>Definition:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">enum</span> <span class="kw">class</span> WeakCallbackType { kParameter, kInternalFields };</a></code></pre></div>
</body>
</html>
