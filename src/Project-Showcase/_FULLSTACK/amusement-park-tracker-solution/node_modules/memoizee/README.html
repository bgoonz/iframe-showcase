<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p><a href="https://semaphoreci.com/medikoo-org/memoizee"><img src="https://semaphoreci.com/api/v1/medikoo-org/memoizee/branches/master/shields_badge.svg" alt="*nix build status" /></a> <a href="https://ci.appveyor.com/project/medikoo/memoizee"><img src="https://ci.appveyor.com/api/projects/status/hsxubnbwe89c26bu?svg=true" alt="Windows build status" /></a> <img src="https://img.shields.io/badge/transpilation-free-brightgreen.svg" alt="Transpilation status" /> <a href="https://www.npmjs.com/package/memoizee"><img src="https://img.shields.io/npm/v/memoizee.svg" alt="npm version" /></a></p>
<h1 id="memoizee">Memoizee</h1>
<h2 id="complete-memoizecache-solution-for-javascript">Complete memoize/cache solution for JavaScript</h2>
<p><em>Originally derived from <a href="https://github.com/medikoo/es5-ext">es5-ext</a> package.</em></p>
<p>Memoization is best technique to save on memory or CPU cycles when we deal with repeated operations. For detailed insight see: http://en.wikipedia.org/wiki/Memoization</p>
<h3 id="features">Features</h3>
<ul>
<li>Works with any type of function arguments – <strong>no serialization is needed</strong></li>
<li>Works with <a href="#arguments-length"><strong>any length of function arguments</strong></a>. Length can be set as fixed or dynamic.</li>
<li>One of the <a href="#benchmarks"><strong>fastest</strong></a> available solutions.</li>
<li>Support for <a href="#promise-returning-functions"><strong>promises</strong></a> and <a href="#nodejs-callback-style-functions"><strong>asynchronous functions</strong></a></li>
<li><a href="#primitive-mode"><strong>Primitive mode</strong></a> which assures fast performance when arguments are convertible to strings.</li>
<li><a href="#weakmap-based-configurations"><strong>WeakMap based mode</strong></a> for garbage collection friendly configuration</li>
<li>Can be configured <a href="#memoizing-methods"><strong>for methods</strong></a> (when <code>this</code> counts in)</li>
<li>Cache <a href="#manual-clean-up"><strong>can be cleared manually</strong></a> or <a href="#expire-cache-after-given-period-of-time"><strong>after specified timeout</strong></a></li>
<li>Cache size can be <strong><a href="#limiting-cache-size">limited on LRU basis</a></strong></li>
<li>Optionally <a href="#resolvers"><strong>accepts resolvers</strong></a> that normalize function arguments before passing them to underlying function.</li>
<li>Optional <a href="#reference-counter"><strong>reference counter mode</strong></a>, that allows more sophisticated cache management</li>
<li><a href="#profiling--statistics"><strong>Profile tool</strong></a> that provides valuable usage statistics</li>
<li>Covered by <a href="#tests"><strong>over 500 unit tests</strong></a></li>
</ul>
<h3 id="installation">Installation</h3>
<p>In your project path — <strong>note the two <code>e</code>’s in <code>memoizee</code>:</strong></p>
<pre><code>$ npm install memoizee</code></pre>
<p><em><code>memoize</code> name was already taken, therefore project is published as <code>memoizee</code> on NPM.</em></p>
<p>To port it to Browser or any other (non CJS) environment, use your favorite CJS bundler. No favorite yet? Try: <a href="http://browserify.org/">Browserify</a>, <a href="https://github.com/medikoo/modules-webmake">Webmake</a> or <a href="http://webpack.github.io/">Webpack</a></p>
<h3 id="usage">Usage</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">var</span> memoize <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;memoizee&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">var</span> fn <span class="op">=</span> <span class="kw">function</span>(one<span class="op">,</span> two<span class="op">,</span> three) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="co">/* ... */</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7">memoized <span class="op">=</span> <span class="at">memoize</span>(fn)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="st">&quot;bar&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="st">&quot;bar&quot;</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a></code></pre></div>
<h3 id="configuration">Configuration</h3>
<p>All below options can be applied in any combination</p>
<h4 id="arguments-length">Arguments length</h4>
<p>By default fixed number of arguments that function take is assumed (it’s read from function’s <code>length</code> property) this can be overridden:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">length</span><span class="op">:</span> <span class="dv">2</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span>)<span class="op">;</span> <span class="co">// Assumed: &#39;foo&#39;, undefined</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="kw">undefined</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="op">{}</span>)<span class="op">;</span> <span class="co">// Third argument is ignored (but passed to underlying function)</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">13</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a></code></pre></div>
<p><strong>Note:</strong> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Default_parameters">Parameters predefined with default values (ES2015+ feature)</a> are not reflected in function’s <code>length</code>, therefore if you want to memoize them as well, you need to tweak <code>length</code> setting accordingly</p>
<p>Dynamic <em>length</em> behavior can be forced by setting <em>length</em> to <code>false</code>, that means memoize will work with any number of arguments.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">length</span><span class="op">:</span> <span class="kw">false</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="kw">undefined</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="kw">undefined</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="op">{}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">13</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">13</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a></code></pre></div>
<h4 id="primitive-mode">Primitive mode</h4>
<p>If we work with large result sets, or memoize hot functions, default mode may not perform as fast as we expect. In that case it’s good to run memoization in <em>primitive</em> mode. To provide fast access, results are saved in hash instead of an array. Generated hash ids are result of arguments to string conversion. <strong>Mind that this mode will work correctly only if stringified arguments produce unique strings.</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">primitive</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="at">memoized</span>(<span class="st">&quot;/path/one&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="at">memoized</span>(<span class="st">&quot;/path/one&quot;</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a></code></pre></div>
<h4 id="cache-id-resolution-normalization">Cache id resolution (normalization)</h4>
<p>By default cache id for given call is resolved either by:</p>
<ul>
<li>Direct Comparison of values passed in arguments as they are. In such case two different objects, even if their characteristics is exactly same (e.g. <code>var a = { foo: 'bar' }, b = { foo: 'bar' }</code>) will be treated as two different values.</li>
<li>Comparison of stringified values of given arguments (<code>primitive</code> mode), which serves well, when arguments are expected to be primitive values, or objects that stringify naturally do unique values (e.g. arrays)</li>
</ul>
<p>Still above two methods do not serve all cases, e.g. if we want to memoize function where arguments are hash objects which we do not want to compare by instance but by its content.</p>
<h5 id="writing-custom-cache-id-normalizers">Writing custom cache id normalizers</h5>
<p>There’s a <code>normalizer</code> option through which we can pass custom cache id normalization function<br />
e.g. if we want to memoize a function where argument is a hash object which we do not want to compare by instance but by its content, then we can achieve it as following:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">var</span> mfn <span class="op">=</span> <span class="at">memoize</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">    <span class="kw">function</span>(hash) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">        <span class="co">// body of memoized function</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="op">},</span></a>
<a class="sourceLine" id="cb6-5" title="5">    <span class="op">{</span></a>
<a class="sourceLine" id="cb6-6" title="6">        <span class="dt">normalizer</span><span class="op">:</span> <span class="kw">function</span>(args) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">            <span class="co">// args is arguments object as accessible in memoized function</span></a>
<a class="sourceLine" id="cb6-8" title="8">            <span class="cf">return</span> <span class="va">JSON</span>.<span class="at">stringify</span>(args[<span class="dv">0</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb6-9" title="9">        <span class="op">}</span></a>
<a class="sourceLine" id="cb6-10" title="10">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-11" title="11">)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-12" title="12"></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="at">mfn</span>(<span class="op">{</span> <span class="dt">foo</span><span class="op">:</span> <span class="st">&quot;bar&quot;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="at">mfn</span>(<span class="op">{</span> <span class="dt">foo</span><span class="op">:</span> <span class="st">&quot;bar&quot;</span> <span class="op">}</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a></code></pre></div>
<h4 id="argument-resolvers">Argument resolvers</h4>
<p>When we’re expecting arguments of certain type it’s good to coerce them before doing memoization. We can do that by passing additional resolvers array:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">length</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span> <span class="dt">resolvers</span><span class="op">:</span> [String<span class="op">,</span> Boolean] <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="at">memoized</span>(<span class="dv">12</span><span class="op">,</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>].<span class="at">length</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="at">memoized</span>(<span class="st">&quot;12&quot;</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="at">memoized</span>(</a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="op">{</span></a>
<a class="sourceLine" id="cb7-7" title="7">        <span class="dt">toString</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb7-8" title="8">            <span class="cf">return</span> <span class="st">&quot;12&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-9" title="9">        <span class="op">}</span></a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="op">},</span></a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="op">{}</span></a>
<a class="sourceLine" id="cb7-12" title="12">)<span class="op">;</span> <span class="co">// Cache hit</span></a></code></pre></div>
<p><strong>Note. If your arguments are collections (arrays or hashes) that you want to memoize by content (not by self objects), you need to cast them to strings</strong>, for it’s best to just use <a href="#primitive-mode">primitive mode</a>. Arrays have standard string representation and work with primitive mode out of a box, for hashes you need to define <code>toString</code> method, that will produce unique string descriptions, or rely on <code>JSON.stringify</code>.</p>
<p>Similarly <strong>if you want to memoize functions by their code representation not by their objects, you should use primitive mode</strong>.</p>
<h4 id="memoizing-asynchronous-functions">Memoizing asynchronous functions</h4>
<h5 id="promise-returning-functions">Promise returning functions</h5>
<p>With <em>promise</em> option we indicate that we memoize a function that returns promise.</p>
<p>The difference from natural behavior is that in case when promise was rejected with exception, the result is immediately removed from memoize cache, and not kept as further reusable result.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">var</span> afn <span class="op">=</span> <span class="kw">function</span>(a<span class="op">,</span> b) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">    <span class="cf">return</span> <span class="kw">new</span> <span class="at">Promise</span>(<span class="kw">function</span>(res) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-3" title="3">        <span class="at">res</span>(a <span class="op">+</span> b)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-4" title="4">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb8-6" title="6">memoized <span class="op">=</span> <span class="at">memoize</span>(afn<span class="op">,</span> <span class="op">{</span> <span class="dt">promise</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="at">memoized</span>(<span class="dv">3</span><span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="at">memoized</span>(<span class="dv">3</span><span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a></code></pre></div>
<h6 id="important-notice-on-internal-promises-handling">Important notice on internal promises handling</h6>
<p>Default handling stands purely on <em>then</em> which has side-effect of muting eventual unhandled rejection notifications. Alternatively we can other (explained below), by stating with <code>promise</code> option desired mode:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(afn<span class="op">,</span> <span class="op">{</span> <span class="dt">promise</span><span class="op">:</span> <span class="st">&quot;done:finally&quot;</span> <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Supported modes</p>
<ul>
<li><p><code>then</code> <em>(default)</em>. Values are resolved purely by passing callbacks to <code>promise.then</code>. <strong>Side effect is that eventual unhandled rejection on given promise come with no logged warning!</strong>, and that to avoid implied error swallowing both states are resolved tick after callbacks were invoked</p></li>
<li><p><code>done</code> Values are resolved purely by passing callback to <code>done</code> method. <strong>Side effect is that eventual unhandled rejection on given promise come with no logged warning!</strong>.</p></li>
<li><p><code>done:finally</code> The only method that may work with no side-effects assuming that promise implementaion does not throw unconditionally if no <em>onFailure</em> callback was passed to <code>done</code>, and promise error was handled by other consumer (this is not commonly implemented <em>done</em> behavior). Otherwise side-effect is that exception is thrown on promise rejection (highly not recommended)</p></li>
</ul>
<h5 id="node.js-callback-style-functions">Node.js callback style functions</h5>
<p>With <em>async</em> option we indicate that we memoize asynchronous (Node.js style) function Operations that result with an error are not cached.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1">afn <span class="op">=</span> <span class="kw">function</span>(a<span class="op">,</span> b<span class="op">,</span> cb) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">    <span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-3" title="3">        <span class="at">cb</span>(<span class="kw">null</span><span class="op">,</span> a <span class="op">+</span> b)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-4" title="4">    <span class="op">},</span> <span class="dv">200</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb10-6" title="6">memoized <span class="op">=</span> <span class="at">memoize</span>(afn<span class="op">,</span> <span class="op">{</span> <span class="dt">async</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-7" title="7"></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="at">memoized</span>(<span class="dv">3</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="kw">function</span>(err<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-9" title="9">    <span class="at">memoized</span>(<span class="dv">3</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="kw">function</span>(err<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-10" title="10">        <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb10-11" title="11">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-13" title="13"></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="at">memoized</span>(<span class="dv">3</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="kw">function</span>(err<span class="op">,</span> res) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-15" title="15">    <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h4 id="memoizing-methods">Memoizing methods</h4>
<p>When we are defining a prototype, we may want to define a method that will memoize it’s results in relation to each instance. A basic way to obtain that would be:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">var</span> Foo <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">    <span class="kw">this</span>.<span class="at">bar</span> <span class="op">=</span> <span class="at">memoize</span>(<span class="kw">this</span>.<span class="va">bar</span>.<span class="at">bind</span>(<span class="kw">this</span>)<span class="op">,</span> <span class="op">{</span> <span class="dt">someOption</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3">    <span class="co">// ... constructor logic</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="va">Foo</span>.<span class="va">prototype</span>.<span class="at">bar</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb11-6" title="6">    <span class="co">// ... method logic</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="op">};</span></a></code></pre></div>
<p>There’s a lazy methods descriptor generator provided:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">var</span> d <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;d&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">var</span> memoizeMethods <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;memoizee/methods&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw">var</span> Foo <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb12-5" title="5">    <span class="co">// ... constructor logic</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="op">};</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="va">Object</span>.<span class="at">defineProperties</span>(</a>
<a class="sourceLine" id="cb12-8" title="8">    <span class="va">Foo</span>.<span class="at">prototype</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-9" title="9">    <span class="at">memoizeMethods</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb12-10" title="10">        <span class="dt">bar</span><span class="op">:</span> <span class="at">d</span>(</a>
<a class="sourceLine" id="cb12-11" title="11">            <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb12-12" title="12">                <span class="co">// ... method logic</span></a>
<a class="sourceLine" id="cb12-13" title="13">            <span class="op">},</span></a>
<a class="sourceLine" id="cb12-14" title="14">            <span class="op">{</span> <span class="dt">someOption</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb12-15" title="15">        )</a>
<a class="sourceLine" id="cb12-16" title="16">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb12-17" title="17">)<span class="op">;</span></a></code></pre></div>
<h4 id="weakmap-based-configurations">WeakMap based configurations</h4>
<p>In this case memoization cache is not bound to memoized function (which we may want to keep forever), but to objects for which given results were generated.</p>
<p>This mode works only for functions of which first argument is expected to be an object.<br />
It can be combined with other options mentioned across documentation. However due to WeakMap specificity global clear is not possible.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">var</span> memoize <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;memoizee/weak&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">var</span> memoized <span class="op">=</span> <span class="at">memoize</span>(<span class="kw">function</span>(obj) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-4" title="4">    <span class="cf">return</span> <span class="va">Object</span>.<span class="at">keys</span>(obj)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-6" title="6"></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="kw">var</span> obj <span class="op">=</span> <span class="op">{</span> <span class="dt">foo</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">bar</span><span class="op">:</span> <span class="kw">false</span> <span class="op">};</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="at">memoized</span>(obj)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="at">memoized</span>(obj)<span class="op">;</span> <span class="co">// Cache hit</span></a></code></pre></div>
<h4 id="cache-handling">Cache handling</h4>
<h5 id="manual-clean-up">Manual clean up:</h5>
<p>Delete data for particular call.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="va">memoized</span>.<span class="at">delete</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="kw">true</span>)<span class="op">;</span></a></code></pre></div>
<p>Arguments passed to <code>delete</code> are treated with same rules as input arguments passed to function</p>
<p>Clear all cached data:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="va">memoized</span>.<span class="at">clear</span>()<span class="op">;</span></a></code></pre></div>
<h5 id="expire-cache-after-given-period-of-time">Expire cache after given period of time</h5>
<p>With <em>maxAge</em> option we can ensure that cache for given call is cleared after predefined period of time (in milliseconds)</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">1000</span> <span class="op">}</span>)<span class="op">;</span> <span class="co">// 1 second</span></a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb16-6" title="6">    <span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// No longer in cache, re-executed</span></a>
<a class="sourceLine" id="cb16-7" title="7">    <span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="op">},</span> <span class="dv">2000</span>)<span class="op">;</span></a></code></pre></div>
<p>Additionally we may ask to <em>pre-fetch</em> in a background a value that is about to expire. <em>Pre-fetch</em> is invoked only if value is accessed close to its expiry date. By default it needs to be within at least 33% of <em>maxAge</em> timespan before expire:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span> <span class="dt">preFetch</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)<span class="op">;</span> <span class="co">// Defaults to 0.33</span></a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb17-5" title="5"></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb17-7" title="7">    <span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="op">},</span> <span class="dv">500</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-9" title="9"></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb17-11" title="11">    <span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit, silently pre-fetched in next tick</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="op">},</span> <span class="dv">800</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-13" title="13"></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb17-15" title="15">    <span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb17-16" title="16"><span class="op">},</span> <span class="dv">1300</span>)<span class="op">;</span></a></code></pre></div>
<p><em>Pre-fetch</em> timespan can be customized:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">maxAge</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span> <span class="dt">preFetch</span><span class="op">:</span> <span class="fl">0.6</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-2" title="2"></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb18-5" title="5"></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb18-7" title="7">    <span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit, silently pre-fetched in next tick</span></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="op">},</span> <span class="dv">500</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-9" title="9"></a>
<a class="sourceLine" id="cb18-10" title="10"><span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb18-11" title="11">    <span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb18-12" title="12"><span class="op">},</span> <span class="dv">1300</span>)<span class="op">;</span></a></code></pre></div>
<p><em>Thanks <span class="citation" data-cites="puzrin">[@puzrin]</span>(https://github.com/puzrin) for helpful suggestions concerning this functionality</em></p>
<h5 id="reference-counter">Reference counter</h5>
<p>We can track number of references returned from cache, and manually delete them. When the last reference is cleared, the cache is purged automatically:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">refCounter</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb19-2" title="2"></a>
<a class="sourceLine" id="cb19-3" title="3"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// refs: 1</span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit, refs: 2</span></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit, refs: 3</span></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="va">memoized</span>.<span class="at">deleteRef</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// refs: 2</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="va">memoized</span>.<span class="at">deleteRef</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// refs: 1</span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="va">memoized</span>.<span class="at">deleteRef</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// refs: 0, Cache purged for &#39;foo&#39;, 3</span></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Re-executed, refs: 1</span></a></code></pre></div>
<h5 id="limiting-cache-size">Limiting cache size</h5>
<p>With <em>max</em> option you can limit cache size, it’s backed with <a href="http://en.wikipedia.org/wiki/Cache_algorithms#Least_Recently_Used">LRU algorithm</a>, provided by low-level <a href="https://github.com/medikoo/lru-queue">lru-queue</a> utility.</p>
<p>The <em>size</em> relates purely to count of results we want to keep in cache, it doesn’t relate to memory cost associated with cache value (but such feature is likely to be introduced with next version of memoizee).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-2" title="2"></a>
<a class="sourceLine" id="cb20-3" title="3"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="at">memoized</span>(<span class="st">&quot;bar&quot;</span><span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb20-6" title="6"><span class="at">memoized</span>(<span class="st">&quot;bar&quot;</span><span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb20-7" title="7"><span class="at">memoized</span>(<span class="st">&quot;lorem&quot;</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">;</span> <span class="co">// Cache cleared for &#39;foo&#39;, 3</span></a>
<a class="sourceLine" id="cb20-8" title="8"><span class="at">memoized</span>(<span class="st">&quot;bar&quot;</span><span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Re-executed, Cache cleared for &#39;lorem&#39;, 11</span></a>
<a class="sourceLine" id="cb20-10" title="10"><span class="at">memoized</span>(<span class="st">&quot;lorem&quot;</span><span class="op">,</span> <span class="dv">11</span>)<span class="op">;</span> <span class="co">// Re-executed, Cache cleared for &#39;bar&#39;, 7</span></a>
<a class="sourceLine" id="cb20-11" title="11"><span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Cache hit</span></a>
<a class="sourceLine" id="cb20-12" title="12"><span class="at">memoized</span>(<span class="st">&quot;bar&quot;</span><span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span> <span class="co">// Re-executed, Cache cleared for &#39;lorem&#39;, 11</span></a></code></pre></div>
<h5 id="registering-dispose-callback">Registering dispose callback</h5>
<p>You can register a callback to be called on each value removed from the cache:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" title="1">memoized <span class="op">=</span> <span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb21-2" title="2">    <span class="dt">dispose</span><span class="op">:</span> <span class="kw">function</span>(value) <span class="op">{</span></a>
<a class="sourceLine" id="cb21-3" title="3">        <span class="co">/*…*/</span></a>
<a class="sourceLine" id="cb21-4" title="4">    <span class="op">}</span></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-6" title="6"></a>
<a class="sourceLine" id="cb21-7" title="7"><span class="kw">var</span> foo3 <span class="op">=</span> <span class="at">memoized</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-8" title="8"><span class="kw">var</span> bar7 <span class="op">=</span> <span class="at">memoized</span>(<span class="st">&quot;bar&quot;</span><span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb21-9" title="9"><span class="va">memoized</span>.<span class="at">clear</span>(<span class="st">&quot;foo&quot;</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span> <span class="co">// Dispose called with foo3 value</span></a>
<a class="sourceLine" id="cb21-10" title="10"><span class="va">memoized</span>.<span class="at">clear</span>(<span class="st">&quot;bar&quot;</span><span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span> <span class="co">// Dispose called with bar7 value</span></a></code></pre></div>
<h3 id="benchmarks">Benchmarks</h3>
<p>Simple benchmark tests can be found in <em>benchmark</em> folder. Currently it’s just plain simple calculation of fibonacci sequences. To run it you need to install other test candidates:</p>
<pre><code>$ npm install underscore lodash lru-cache secondary-cache</code></pre>
<p>Example output taken under Node v0.10.35 on 2011 MBP Pro:</p>
<pre><code>Fibonacci 3000 x10:

1:    15ms  Memoizee (primitive mode)
2:    15ms  Underscore
3:    18ms  lru-cache                 LRU (max: 1000)
4:    21ms  secondary-cache           LRU (max: 1000)
5:    37ms  Lo-dash
6:    62ms  Memoizee (primitive mode) LRU (max: 1000)
7:   163ms  Memoizee (object mode)    LRU (max: 1000)
8:   195ms  Memoizee (object mode)</code></pre>
<h3 id="profiling-statistics">Profiling &amp; Statistics</h3>
<p>If you want to make sure how much you benefit from memoization or just check if memoization works as expected, loading profile module will give access to all valuable information.</p>
<p><strong>Module needs to be imported before any memoization (that we want to track) is configured. Mind also that running profile module affects performance, it’s best not to use it in production environment</strong></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">var</span> memProfile <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;memoizee/profile&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb24-2" title="2">...</a>
<a class="sourceLine" id="cb24-3" title="3">...</a>
<a class="sourceLine" id="cb24-4" title="4"><span class="at">memoize</span>(fn)<span class="op">;</span></a>
<a class="sourceLine" id="cb24-5" title="5">...</a>
<a class="sourceLine" id="cb24-6" title="6"><span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">profileName</span><span class="op">:</span> <span class="st">&#39;Some Function&#39;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb24-7" title="7">...</a>
<a class="sourceLine" id="cb24-8" title="8"><span class="at">memoize</span>(fn<span class="op">,</span> <span class="op">{</span> <span class="dt">profileName</span><span class="op">:</span> <span class="st">&#39;Another Function&#39;</span> <span class="op">}</span>)</a></code></pre></div>
<p>Access statistics at any time:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" title="1"><span class="va">memProfile</span>.<span class="at">statistics</span><span class="op">;</span> <span class="co">// Statistics accessible for programmatic use</span></a>
<a class="sourceLine" id="cb25-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="va">memProfile</span>.<span class="at">log</span>())<span class="op">;</span> <span class="co">// Output statistics data in readable form</span></a></code></pre></div>
<p>Example console output:</p>
<pre><code>------------------------------------------------------------
Memoize statistics:

 Init  Cache  %Cache  Source location
11604  35682   75.46  (all)
 2112  19901   90.41  Some Function, at /Users/medikoo/Projects/_packages/next/lib/fs/is-ignored.js:276:12
 2108   9087   81.17  Another Function, at /Users/medikoo/Projects/_packages/next/lib/fs/is-ignored.js:293:10
 6687   2772   29.31  at /Users/medikoo/Projects/_packages/next/lib/fs/watch.js:125:9
  697   3922   84.91  at /Users/medikoo/Projects/_packages/next/lib/fs/is-ignored.js:277:15
------------------------------------------------------------</code></pre>
<ul>
<li><em>Init</em> – Initial hits</li>
<li><em>Cache</em> – Cache hits</li>
<li><em>%Cache</em> – What’s the percentage of cache hits (of all function calls)</li>
<li><em>Source location</em> – Where in the source code given memoization was initialized</li>
</ul>
<h3 id="tests">Tests</h3>
<pre><code>$ npm test</code></pre>
<p>Project cross-browser compatibility to be supported by:</p>
<p><a href="https://browserstack.com"><img src="https://bstacksupport.zendesk.com/attachments/token/Pj5uf2x5GU9BvWErqAr51Jh2R/?name=browserstack-logo-600x315.png" height="150" /></a></p>
<h3 id="contributors">Contributors</h3>
<ul>
<li><span class="citation" data-cites="puzrin">[@puzrin]</span>(https://github.com/puzrin) (Vitaly Puzrin)
<ul>
<li>Proposal and help with coining right <em>pre-fetch</em> logic for <a href="https://github.com/medikoo/memoize#expire-cache-after-given-period-of-time"><em>maxAge</em></a> variant</li>
</ul></li>
</ul>
</body>
</html>
